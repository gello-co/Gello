{
  "name": "Gello Development",
  "build": {
    "dockerfile": "Dockerfile",
    "context": "."
  },
  "runArgs": ["--init"],
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "oven.bun-vscode",
        "biomejs.biome",
        "ms-playwright.playwright",
        "mkcert.mkcert",
        "ms-azuretools.vscode-docker",
        "ms-vscode-remote.remote-containers",
        "ms-vscode-remote.remote-ssh",
        "editorconfig.editorconfig",
        "ms-vscode.vscode-typescript-next",
        "christian-kohler.npm-intellisense",
        "MylesMurphy.prettify-ts",
        "timonwong.shellcheck",
        "dorzey.vscode-sqlfluff",
        "bradlc.vscode-tailwindcss",
        "yzhang.markdown-all-in-one",
        "docker.docker",
        "pranaygp.vscode-css-peek",

        // Enhanced extensions
        "supabase.supabase-vscode",
        "mtxr.sqltools",
        "mtxr.sqltools-driver-pg",
        "usernamehw.errorlens",
        "eamodio.gitlens",
        "streetsidesoftware.code-spell-checker",
        "davidanson.vscode-markdownlint",
        "gruntfuggly.todo-tree"
      ],
      "settings": {
        "editor.defaultFormatter": "biomejs.biome",
        "editor.formatOnSave": true,
        "[typescript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[javascript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[json]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[jsonc]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "files.exclude": {
          "**/.git": true,
          "**/.DS_Store": true,
          "**/node_modules": false
        },
        "search.exclude": {
          "**/node_modules": true,
          "**/dist": true,
          "**/.devcontainer": true
        },

        // Enhanced settings
        "sqltools.connections": [
          {
            "name": "Supabase Local",
            "driver": "PostgreSQL",
            "server": "localhost",
            "port": 54322,
            "database": "postgres",
            "username": "postgres",
            "password": "postgres",
            "connectionTimeout": 30
          }
        ],
        "tailwindCSS.experimental.classRegex": [
          ["class:\\s*?[\"'`]([^\"'`]*).*?[\"'`]", "[\"'`]([^\"'`]*).*?[\"'`]"]
        ],
        "typescript.tsdk": "node_modules/typescript/lib",
        "errorLens.enabledDiagnosticLevels": ["error", "warning"],
        "gitlens.codeLens.enabled": false,
        "gitlens.currentLine.enabled": false
      }
    }
  },

  "postCreateCommand": "bash .devcontainer/bootstrap.sh",
  "postAttachCommand": "echo 'ðŸ¤– Gello dev container ready. Run: bun run dev'",

  "remoteUser": "vscode",
  "mounts": [
    "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached",
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind",
    "source=${localEnv:HOME}/.local/share/mkcert,target=/home/vscode/.local/share/mkcert,type=bind",
    "source=gello-node-modules,target=/workspace/node_modules,type=volume"
  ],
  "workspaceFolder": "/workspace",

  // Forward all necessary ports
  "forwardPorts": [3000, 54321, 54322, 54323, 54324, 54325, 54326],
  "portsAttributes": {
    "3000": {
      "label": "App Server",
      "onAutoForward": "notify"
    },
    "54321": {
      "label": "Supabase API",
      "onAutoForward": "silent"
    },
    "54322": {
      "label": "Supabase DB",
      "onAutoForward": "silent"
    },
    "54323": {
      "label": "Supabase Studio",
      "onAutoForward": "silent"
    },
    "54324": {
      "label": "Supabase Inbucket",
      "onAutoForward": "silent"
    },
    "54325": {
      "label": "Supabase Storage",
      "onAutoForward": "silent"
    },
    "54326": {
      "label": "Supabase Auth",
      "onAutoForward": "silent"
    }
  },

  // Environment variables
  "containerEnv": {
    "SHELL": "/bin/zsh",
    "ALLOW_TEST_BYPASS": "true",
    "AUTO_DEV_LOGIN_EMAIL": "admin@example.com",
    "AUTO_DEV_LOGIN_PASSWORD": "password123",
    "NODE_ENV": "development",
    "TZ": "UTC",
    "SUPABASE_URL": "http://127.0.0.1:54321",
    "DATABASE_URL": "postgresql://postgres:postgres@127.0.0.1:54322/postgres",
    "BUN_INSTALL_CACHE_DIR": "/workspace/.bun-cache",
    "FULL_SETUP_ON_CREATE": "${localEnv:FULL_SETUP_ON_CREATE:false}",
    "FULL_SETUP_METRICS": "${localEnv:FULL_SETUP_METRICS:true}",
    "DOPPLER_TOKEN": "${localEnv:DOPPLER_TOKEN}"
  }
}
