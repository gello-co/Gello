<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gello Code Tour - Project Overview</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/dist/reveal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/dist/theme/black.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/plugin/highlight/monokai.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../assets/css/gello.css">
</head>
<body>
  <!-- Back to Index Button -->
  <a href="../index.html" class="nav-home" title="Back to Tours" aria-label="Back to tour index">
    <i class="bi bi-house-fill"></i>
  </a>

  <!-- Breadcrumb Navigation -->
  <nav class="slide-breadcrumb" aria-label="Breadcrumb">
    <a href="../index.html">Tours</a>
    <span class="separator">→</span>
    <span class="current">Project Overview</span>
  </nav>

  <!-- Progress Bar -->
  <div class="slide-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
    <div class="slide-progress-bar"></div>
  </div>
  <span class="slide-progress-text" aria-live="polite">1 / 6</span>

  <div class="reveal">
    <div class="slides">
      <section class="title-slide">
        <h1>Project Overview</h1>
        <p class="subtitle">Gello Codebase Tour - Part 1</p>
        <p class="muted">Press <kbd>→</kbd> to navigate · <kbd>s</kbd> for speaker notes</p>
        <aside class="notes">Welcome to Gello. This tour covers project structure, tech stack, and getting started.</aside>
      </section>

      <section>
        <h2>Gello at a Glance</h2>
        <div class="columns">
          <div>
            <h3>What It Is</h3>
            <ul>
              <li class="fragment">Trello-inspired task management</li>
              <li class="fragment">Points system + leaderboards</li>
              <li class="fragment">Server-side rendering focus</li>
            </ul>
          </div>
          <div>
            <h3>Tech Stack</h3>
            <ul>
              <li class="fragment"><span class="badge">Bun</span> + <span class="badge">Express 5</span></li>
              <li class="fragment"><span class="badge">Handlebars</span> + <span class="badge">HTMX</span></li>
              <li class="fragment"><span class="badge">Supabase</span> + <span class="badge">RLS</span></li>
              <li class="fragment"><span class="badge">Alpine.js</span> + <span class="badge">Bootstrap</span></li>
            </ul>
          </div>
        </div>
        <aside class="notes">Gamified project management. SSR with progressive enhancement via HTMX. Supabase handles auth and database with Row Level Security.</aside>
      </section>

      <section>
        <h2>Project Structure</h2>
        <div class="columns">
          <div>
            <pre class="tree"><code>gello/
├── ProjectSourceCode/src/
│   ├── index.ts        # Entry
│   ├── express/        # Routes, views
│   ├── lib/            # Services, DB
│   └── middleware/
├── supabase/           # Migrations
├── tests/              # All tests
└── docs/               # Documentation</code></pre>
          </div>
          <div>
            <h3>Entry Points</h3>
            <table style="font-size: 0.75em;">
              <tr class="fragment"><td><code>src/index.ts</code></td><td>Server (port 3000)</td></tr>
              <tr class="fragment"><td><code>express/app.ts</code></td><td>Express config</td></tr>
              <tr class="fragment"><td><code>bootstrap.sh</code></td><td>Full startup</td></tr>
            </table>
          </div>
        </div>
        <aside class="notes">Main code in ProjectSourceCode/src. Three tiers: express routes, lib for business logic, middleware for cross-cutting concerns.</aside>
      </section>

      <section>
        <h2>Getting Started</h2>
        <div class="columns">
          <div>
            <h3>Commands</h3>
            <pre><code class="language-bash"># Full startup (DB + server)
bun run start

# Dev with hot reload
bun run dev

# Reset and reseed
bun run start:fresh</code></pre>
          </div>
          <div>
            <h3>Code Quality</h3>
            <pre><code class="language-bash"># Format + lint (Biome)
bun run check

# TypeScript check
bun run typecheck

# Run tests
bun test</code></pre>
          </div>
        </div>
        <p class="fragment muted">Uses Biome (not Prettier/ESLint) · Doppler for secrets</p>
        <aside class="notes">bun run start handles everything. Biome is faster than ESLint+Prettier combined.</aside>
      </section>

      <section>
        <h2>Conventions</h2>
        <div class="columns">
          <div>
            <h3>File Naming</h3>
            <ul>
              <li><code>*.service.ts</code> - Business logic</li>
              <li><code>*.db.ts</code> - Database access</li>
              <li><code>*.test.ts</code> - Unit/integration</li>
              <li><code>*.spec.ts</code> - E2E tests</li>
            </ul>
          </div>
          <div>
            <h3>Imports</h3>
            <pre><code class="language-typescript">// Path alias + .js extension
import { authService }
  from '@/lib/services/auth.service.js';

import { Board }
  from '@/types/database.types.js';</code></pre>
          </div>
        </div>
        <p class="fragment muted"><code>@/</code> resolves to <code>src/</code> · Always use <code>.js</code> extension (Bun requirement)</p>
        <aside class="notes">Consistent naming indicates purpose. Bun requires .js extensions even for TypeScript files.</aside>
      </section>

      <section>
        <h2>Summary</h2>
        <ul>
          <li class="fragment"><span class="accent">Stack:</span> Bun + Express + Handlebars + Supabase</li>
          <li class="fragment"><span class="accent">Frontend:</span> HTMX + Alpine.js + Bootstrap</li>
          <li class="fragment"><span class="accent">Architecture:</span> Routes → Services → Database</li>
          <li class="fragment"><span class="accent">Start:</span> <code>bun run start</code></li>
        </ul>
        <p class="fragment" style="margin-top: 2rem;">
          <a href="02-architecture.html">Next: Architecture Tour →</a> · <a href="../index.html">Index</a>
        </p>
        <aside class="notes">Key takeaway: layered architecture with Supabase RLS for security.</aside>
      </section>
    </div>
  </div>

  <!-- Completion Overlay (hidden by default) -->
  <div class="completion-overlay" id="completion-overlay" style="display: none;" x-data="{ show: false }">
    <h3><i class="bi bi-check-circle-fill me-2"></i>Tour Complete</h3>
    <p>You've finished the Project Overview tour</p>
    <div class="actions">
      <a href="02-architecture.html" class="btn btn-primary">Next: Architecture →</a>
      <a href="../index.html" class="btn btn-secondary">Back to Index</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.1.0/plugin/notes/notes.js"></script>
  <!-- Alpine.js for state -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
  <!-- Motion One -->
  <script src="https://cdn.jsdelivr.net/npm/motion@11.18.0/dist/motion.min.js"></script>
  <!-- canvas-confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <!-- Gello Tour Scripts -->
  <script src="../assets/js/tour-progress.js"></script>
  <script src="../assets/js/confetti-setup.js"></script>
  <script src="../assets/js/motion-setup.js"></script>
  <script>
    // Tour configuration
    const TOUR_ID = '01-project-overview';
    const NEXT_TOUR = { id: '02-architecture', name: 'Architecture Tour', url: '02-architecture.html' };

    // Initialize Reveal.js
    Reveal.initialize({
      hash: true,
      slideNumber: false, // We use custom progress bar
      progress: false,    // We use custom progress bar
      history: true,
      plugins: [RevealHighlight, RevealNotes]
    });

    // Update progress bar on slide change
    Reveal.on('slidechanged', () => {
      const current = Reveal.getIndices().h + 1;
      const total = Reveal.getTotalSlides();
      const percent = (current / total) * 100;

      // Update progress bar
      const progressBar = document.querySelector('.slide-progress-bar');
      const progressText = document.querySelector('.slide-progress-text');
      const progressContainer = document.querySelector('.slide-progress');

      if (progressBar) {
        if (window.GelloMotion && !window.GelloMotion.prefersReducedMotion && window.Motion) {
          window.Motion.animate(progressBar, { width: `${percent}%` }, { duration: 0.35, easing: [0.4, 0, 0.2, 1] });
        } else {
          progressBar.style.width = `${percent}%`;
        }
      }
      if (progressText) {
        progressText.textContent = `${current} / ${total}`;
      }
      if (progressContainer) {
        progressContainer.setAttribute('aria-valuenow', Math.round(percent));
      }

      // Check for completion on last slide
      if (Reveal.isLastSlide() && !sessionStorage.getItem(`tour-completed-${TOUR_ID}`)) {
        sessionStorage.setItem(`tour-completed-${TOUR_ID}`, 'true');
        handleTourCompletion();
      }
    });

    // Handle tour completion
    function handleTourCompletion() {
      // Get progress from localStorage
      const storageKey = 'gello-tour-progress';
      let data = JSON.parse(localStorage.getItem(storageKey) || '{}');
      
      // Initialize if needed
      if (!data.tours) {
        data = {
          version: 1,
          tours: {
            '01-project-overview': { completed: false, lastVisit: null },
            '02-architecture': { completed: false, lastVisit: null },
            '03-services': { completed: false, lastVisit: null },
            '04-database': { completed: false, lastVisit: null },
            '05-testing': { completed: false, lastVisit: null }
          },
          allComplete: false
        };
      }

      const wasAlreadyComplete = data.tours[TOUR_ID]?.completed;
      
      if (!wasAlreadyComplete) {
        // Mark complete
        data.tours[TOUR_ID] = {
          completed: true,
          lastVisit: new Date().toISOString()
        };
        data.allComplete = Object.values(data.tours).every(t => t.completed);
        data.lastUpdated = new Date().toISOString();
        localStorage.setItem(storageKey, JSON.stringify(data));

        // Trigger celebration
        if (window.GelloConfetti) {
          window.GelloConfetti.tourComplete();
        }

        // Show completion overlay after a delay
        setTimeout(() => {
          const overlay = document.getElementById('completion-overlay');
          if (overlay) {
            overlay.style.display = 'block';
            if (window.Motion && !window.GelloMotion?.prefersReducedMotion) {
              window.Motion.animate(overlay, { opacity: [0, 1], y: [20, 0] }, { duration: 0.3 });
            }
          }
        }, 1500);

        // Check if all tours complete
        if (data.allComplete && window.GelloConfetti) {
          setTimeout(() => {
            window.GelloConfetti.allToursComplete();
          }, 2500);
        }
      }
    }

    // Add copy buttons to code blocks
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('pre code').forEach(block => {
        const wrapper = block.parentElement;
        wrapper.style.position = 'relative';

        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.innerHTML = '<i class="bi bi-clipboard"></i>';
        button.title = 'Copy to clipboard';
        button.setAttribute('aria-label', 'Copy code to clipboard');

        button.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(block.textContent);
            button.innerHTML = '<i class="bi bi-check2"></i>';
            button.classList.add('copied');

            setTimeout(() => {
              button.innerHTML = '<i class="bi bi-clipboard"></i>';
              button.classList.remove('copied');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        });

        wrapper.appendChild(button);
      });

      // Initialize progress bar
      const total = Reveal.getTotalSlides();
      document.querySelector('.slide-progress-text').textContent = `1 / ${total}`;
      document.querySelector('.slide-progress-bar').style.width = `${(1/total) * 100}%`;
    });
  </script>
</body>
</html>
